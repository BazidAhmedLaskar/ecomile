<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - EcoMiles</title>
    <meta name="description" content="Track your EcoMiles progress, view your sustainability stats, and manage your eco-friendly transportation journeys.">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h1><a href="dashboard.html" style="text-decoration: none; color: inherit;">ğŸŒ± EcoMiles</a></h1>
                </div>
                <div class="profile-menu">
                    <div class="profile-avatar" id="profileAvatar" onclick="toggleProfileMenu()">
                        <img id="profileAvatarImg" src="" alt="Profile" class="profile-avatar-img">
                    </div>
                    <div class="nav-dropdown" id="navDropdown">
                        <ul>
                            <li><a href="dashboard.html"><span class="nav-icon">ğŸ </span>Dashboard</a></li>
                            <li><a href="journey.html"><span class="nav-icon">â•</span>Add Journey</a></li>
                            <li><a href="leaderboard.html"><span class="nav-icon">ğŸ†</span>Leaderboard</a></li>
                            <li><a href="rewards.html"><span class="nav-icon">ğŸ–ï¸</span>Rewards</a></li>
                            <li><a href="profile.html"><span class="nav-icon">ğŸ‘¤</span>Profile</a></li>
                            <li><a href="qr-scanner.html"><span class="nav-icon">ğŸ“±</span>QR Scanner</a></li>
                            <div class="nav-divider"></div>
                            <li class="logout-item"><a href="#" onclick="logout()"><span class="nav-icon">ğŸšª</span>Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <section class="dashboard-header">
            <div class="container">
               <div class="user-info">
  <img id="userAvatar" src="" alt="User Avatar" class="user-avatar" />
  <div class="welcome-wrapper">
    <h2 id="welcomeMessage">
      <span class="hi-fixed">Hi,</span>
      <span id="typedName"></span>
      <span class="wave">ğŸ‘‹</span>
    </h2>
    <p id="userEmail"></p>
  </div>
</div>

            </div>
        </section>

        <section class="dashboard-content">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸŒ±</div>
                        <div class="stat-value" id="totalPoints">0</div>
                        <div class="stat-label">Total EcoPoints</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“</div>
                        <div class="stat-value" id="totalDistance">0 km</div>
                        <div class="stat-label">Distance Traveled</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸŒ</div>
                        <div class="stat-value" id="co2Saved">0 kg</div>
                        <div class="stat-label">COâ‚‚ Saved</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ’°</div>
                        <div class="stat-value" id="roadTaxSaved">â‚¹0</div>
                        <div class="stat-label">Road Tax Saved</div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Weekly EcoPoints Progress</h3>
                    <canvas id="weeklyChart" width="400" height="200"></canvas>
                </div>

                <div class="action-buttons">
                    <a href="journey.html" class="action-btn">
                        â• Add New Journey
                    </a>
                    <a href="leaderboard.html" class="action-btn">
                        ğŸ† View Leaderboard
                    </a>
                    <a href="rewards.html" class="action-btn">
                        ğŸ–ï¸ View Rewards
                    </a>
                    <a href="profile.html" class="action-btn">
                        ğŸ‘¤ My Profile
                    </a>
                </div>

                <div class="recent-journeys" id="recentJourneys">
                    <h3>Recent Journeys</h3>
                    <div id="journeysList" class="journeys-list">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            No journeys yet. <a href="journey.html">Add your first journey!</a>
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Firebase Scripts (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase Configuration -->
    <script src="js/firebase-config.js"></script>
    
    <!-- Global Navigation -->
    <script src="js/navigation.js"></script>
    
    <!-- Dashboard Logic -->
    <script src="js/dashboard.js"></script>
    
    <!-- Profile Avatar Sync JavaScript -->
    <script>
        // Sync profile avatar with user data
        function updateProfileAvatar() {
            const user = getCurrentUser();
            if (user && user.photoURL) {
                const profileAvatarImg = document.getElementById('profileAvatarImg');
                const userAvatar = document.getElementById('userAvatar');
                
                if (profileAvatarImg) {
                    profileAvatarImg.src = user.photoURL;
                }
                
                // Sync with existing user avatar in dashboard
                if (userAvatar) {
                    profileAvatarImg.src = userAvatar.src || user.photoURL;
                }
            }
        }

        // Update profile avatar when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait for Firebase auth to load
            setTimeout(updateProfileAvatar, 1000);
        });

        // Update when user avatar changes
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'src') {
                    updateProfileAvatar();
                }
            });
        });

        // Observe changes to main user avatar
        setTimeout(() => {
            const userAvatar = document.getElementById('userAvatar');
            if (userAvatar) {
                observer.observe(userAvatar, { attributes: true });
            }
        }, 1000);
    </script>
</body>
</html>
